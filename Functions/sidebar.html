<script>

function renderSidebarMaquinas() {
  const container = document.getElementById('maquinas-menu');
  container.innerHTML = '';
  
  if (!maquinasData || maquinasData.length === 0) {
    container.innerHTML = '<p style="font-size: 12px; color: #9CA3AF; padding: 10px;">No hay máquinas disponibles</p>';
    return;
  }
  
  // Primero cargar todos los estados de elementos
  cargarEstadosElementos().then(() => {
    maquinasData.forEach((maquina, maquinaIndex) => {
      const maquinaDiv = document.createElement('div');
      maquinaDiv.className = 'submenu-wrapper';
      
      const submenuId = 'submenu-sidebar-' + maquina.id + '-' + maquinaIndex;
      const estadoMaquina = determinarEstadoMaquina(maquina.id);
      
      // Generar HTML para componentes y elementos
      let componentesHtml = '';
      
      if (maquina.componentes && maquina.componentes.length > 0) {
        componentesHtml = maquina.componentes.map((componente, compIndex) => {
          const componenteSubmenuId = `comp-${maquina.id}-${componente.id}-${compIndex}`;
          const estadoComponente = determinarEstadoComponente(maquina.id, componente.id);
          
          const elementosHtml = (componente.elementos || []).map((elem) => {
            const estadoElemento = determinarEstadoElemento(elem.id);
            const claseEstado = `estado-${estadoElemento}`;
            
            return `
              <div class="elemento-item ${claseEstado}" 
                   onclick="selectElemento('${maquina.id}', '${elem.id}', '${maquina.nombre}', '${elem.nombre}', '${componente.nombre}')"
                   title="Estado: ${estadoElemento.toUpperCase()}">
                ${elem.nombre}
              </div>
            `;
          }).join('');
          
          return `
            <div class="submenu-wrapper">
              <div class="submenu-item componente-item ${estadoComponente}" onclick="toggleSubmenu('${componenteSubmenuId}')">
                <span>${componente.nombre}</span>
                <span class="menu-arrow" id="arrow-${componenteSubmenuId}">▼</span>
              </div>
              <div id="${componenteSubmenuId}" class="submenu-content hidden">
                ${elementosHtml}
              </div>
            </div>
          `;
        }).join('');
      }
      
      maquinaDiv.innerHTML = `
        <div class="submenu-item maquina-item ${estadoMaquina}" onclick="toggleSubmenu('${submenuId}')">
          <span>${maquina.nombre}</span>
          <span class="menu-arrow" id="arrow-${submenuId}">▼</span>
        </div>
        <div id="${submenuId}" class="submenu-content hidden">
          ${componentesHtml}
        </div>
      `;
      container.appendChild(maquinaDiv);
    });
  });
}

function toggleMenu(menuId) {
  const menu = document.getElementById(menuId);
  const arrow = document.getElementById(menuId + '-arrow');
  
  if (menu) menu.classList.toggle('hidden');
  if (arrow) arrow.classList.toggle('rotated');
}

function toggleSubmenu(submenuId) {
  const submenu = document.getElementById(submenuId);
  const arrow = document.getElementById('arrow-' + submenuId);
  
  if (submenu) submenu.classList.toggle('hidden');
  if (arrow) arrow.classList.toggle('rotated');
}

</script>